{% extends 'customer/signup.html' %}
{% load static %}
{% block title %}Login | Cognitix Consulting{% endblock  %}
{% block body %}
<section class="signup">
    <div class="signup-section">
        <div class="signup-flex-column signup-nav">
            <div id="loginSection">
                <h2 id="successmsg">Log In to</h2>
                <h1><span>Cognitix</span> Consulting</h1>
                <p>Log into your Account</p>
                <label for="email">Email</label>
                <div class="signup-forms">
                    <i class='bx bx-envelope'></i>
                    <input type="email" name="email" id="email" placeholder="Your Email">
                </div>
                <label for="password">Password</label>
                <div class="signup-forms">
                    <i class='bx bx-lock-alt'></i>
                    <input type="password" name="password" id="password" placeholder="Your Password">
                    <i class="fa-regular fa-eye fa-eyem" onclick="toggleIcon(this)"></i>
                </div>
                <div class="remember-forgot">
                    <div class="remember">
                        <input type="checkbox" name="check" id="check">
                        <p style="color: #222;">Remember me</p>
                    </div>
                    <p onclick="showForgotPassword()" style="cursor: pointer;">Forgot Password</p>
                </div>
                <div class="signup-forms-button">
                    <button onclick="login()">Log In</button>
                </div>
                <p>Don't Have an account? <a href="/signup">Signup</a></p>
            </div>

            <!-- Forgot Password Section -->
            <div id="forgotPasswordSection" class="hidden">
                <h2 id="text-message">Forgot Password</h2>
                <p>Enter your email to send a password reset link</p>
                <label for="forgotEmail">Email</label>
                <div class="signup-forms">
                    <i class='bx bx-envelope'></i>
                    <input type="email" name="forgotEmail" id="forgotEmail" placeholder="Your Email" >
                </div>
                <div class="signup-forms-button">
                    <button onclick="forgotPassword()">Send Reset Link</button>
                </div>
                <p><a href="/" onclick="showLogin()">Back to Log In</a></p>
            </div>
        </div>
    </div>
    <div class="signup-right signup-left slider">
        <img src="{% static 'images/leftimg.jpg' %}" alt="Image 1" class="active" />
        <img src="{% static 'images/leftimg2.jpg' %}" alt="Image 2" />
        <img src="{% static 'images/leftimg3.jpg' %}" alt="Image 3" />
        <img src="{% static 'images/leftimg4.jpg' %}" alt="Image 4" />
        <img src="{% static 'images/leftimg5.jpg' %}" alt="Image 5" />
    </div>
</section>


<script>
    function toggleIcon(iconElement) {
  let eye = $(iconElement);
  let passwordField = eye.prev("input");
  if (eye.hasClass('fa-eye')) {
    eye.removeClass('fa-eye').addClass("fa-eye-slash");
    passwordField.attr('type', 'text'); 
  } else {
    eye.removeClass('fa-eye-slash').addClass("fa-eye");
    passwordField.attr('type', 'password'); 
  }
}
    function login() { 
        let email = $("#email").val();
        let password = $("#password").val();
        if(!email){
            $("#successmsg").html("Enter Your Email").css('color','#dc3545')
            return;
        }
       else if(!password){
            $("#successmsg").html("Enter Your Password").css('color','#dc3545')
            return;
        }
        $.ajax({
            type:"POST",
            url:"/login_check/",
            data:{
                "email":email,
                "password":password
            },
            success:function(data){
                if(data['status'] == 'pass'){

                    if(data['role'] == 'Admin'){
                        $("#successmsg").html("Login Successful").css('color','#28a475');
                        window.location.href = '/admin_dashboard/'
                    }
                    else if(data['role'] == 'customer'){
                         $("#successmsg").html("Login Successful").css('color','#28a475');
                        window.location.href = '/'
                    }
                }
                else if(data['status'] == 'fail'){
                    $("#successmsg").html(data['message']).css({'color':'#dc3545',"font-size":"18px"})
                }
                else{
                    alert("Failed")
                }
            },
            error:function(xhr, error, status){
                if(error){
                    $("#successmsg").html("Email doesn't exist Please Signup").css({'color':'#dc3545',"font-size":"18px"})
                }
            }
        })
     }
     document.addEventListener('DOMContentLoaded', function() {
    let currentIndex = 0;
    const images = document.querySelectorAll('.signup-left img');
    const totalImages = images.length;

    function showNextImage() {
        images[currentIndex].classList.remove('active');
        currentIndex = (currentIndex + 1) % totalImages;
        images[currentIndex].classList.add('active');
    }

    // Set interval for slider
    setInterval(showNextImage, 3000); // Change image every 3 seconds
});
// Show Forgot Password Section
function showForgotPassword() {
    document.getElementById('loginSection').classList.add('hidden');
    document.getElementById('forgotPasswordSection').classList.add('show');
    setTimeout(() => {
        document.getElementById('loginSection').style.display = 'none';
    }, 500); // Wait for transition to complete before hiding login section
}

// Show Login Section again
function showLogin() {
    document.getElementById('loginSection').classList.remove('hidden');
    document.getElementById('forgotPasswordSection').classList.remove('show');
    setTimeout(() => {
        document.getElementById('forgotPasswordSection').style.display = 'none';
    }, 500); // Wait for transition to complete before hiding forgot password section
}

// Optional: Function for sending reset link
function sendResetLink() {
    const email = document.getElementById('forgotEmail').value;
    alert(`Reset link sent to ${email}`);
}
// AJAX for Forgot Password
function forgotPassword() {
    const email = document.getElementById('forgotEmail').value;

    fetch('/forgot-password/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: JSON.stringify({email: email})
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === "pass") {
            setTimeout(() => {
                $("#text-message").text("Reset Link Sent To "+email).css('color','#28a475');
            }, 2000);
        } else {
            $("#text-message").text('Failed To Send the link').css('color','red');
        }
    });
}
</script>
{% endblock body %}