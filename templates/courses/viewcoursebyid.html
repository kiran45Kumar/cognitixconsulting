{% extends 'customer/index.html' %}
{% block navbar %}
{% load static %}
<style>
    body{
        background: linear-gradient(to right,#fff5f5, #f1f1f1);;
    }
    .video-container {
    position: relative;
    width: 100%; /* Adjust width as needed */
    max-width: 800px; /* Example max width */
    margin: auto;
}

video {
    width: 100%;
    height: auto; /* Maintain aspect ratio */
}

.play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(255, 255, 255, 0.7);
    border: none;
    border-radius: 50%;
    height:50px; /* Increase for larger button */
    width: 50px;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 10; /* Ensure the button is above the video */
    font-size: 18px; /* Icon size */
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5); /* Add shadow for better visibility */
}

.play-button:hover {
    background-color: rgba(255, 255, 255, 1);
}
.course_sample{
    display: flex;
    align-items: center;
    justify-content: center;
}
.course_center{
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 20px;
}
.course_sample {
    height: 600px;
    width: 800px;
    border: 1px solid #06d;
    border-radius: 20px;
}
.course_sample img{
    height: 550px;
    object-fit: cover;
    width: 100%;
    border-radius: 20px;
    margin: 10px;
    padding: 10px;
}
.text-center{
    text-align: center;
    font-size: 29px;
    font-weight: 600;
}
.trainer-card{
    display: flex;
    align-items: center;
    justify-content: start;
    height: 70px;
    border-radius: 10px;
    width: 300px;
    box-shadow: 0px 3px 4px 3px silver;
   
}
.trainer-card img{
    height: 50px;
    width: 50px;
    border-radius: 10px;
    object-fit: cover;
    margin: 10px;
}
.trainer-card{
    margin: 20px;
    box-shadow: 0px 3px 2px 3px silver;
}
.trainer-card p{
    margin: 10px;
    font-size: 20px;
}
.trainer-card-row{
    display: flex;
    align-items: center;
    justify-content: space-evenly;
}
.course-schedules select,input{
    padding: 10px 20px;
}
.course-schedules{
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 10px;
}
.column{
    display: flex;
    flex-direction: column;
}
#results {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 20px;
}

/* Individual schedule item styling */
.schedule-item {
    background-color: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 16px;
    width: 280px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

/* Add a hover effect */
.schedule-item:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
}

/* Heading for the trainer name */
.schedule-item h4 {
    font-size: 18px;
    color: #333;
    margin: 0 0 10px;
}

/* Details for region and date */
.schedule-item p {
    font-size: 14px;
    color: #555;
    margin: 5px 0;
}

/* Additional styling for region and date labels */
.schedule-item p span.label {
    font-weight: bold;
    color: #444;
}
</style>
<body>
    <div class="hero-section course-view-section">
        <div class="hero-left box-shadow-medium">
           <div class="course-left">
                    <p><i class='bx bx-home-alt-2' ></i></p>
                    <p>></p>
                    <p> {{course_by_id.category}}</p>
                    <p>></p>
                    <span>{{course_by_id.title}}</span>
           </div>
           <div class="course-name">
                    <h4>{{course_by_id.title}} Course</h4>
                    <p>{{course_by_id.description}}</p>
                    <p><b>Skills Gained: </b>{{course_by_id.skillsgain|linebreaks}} </p>
        <div class="course-details">
           <div class="course-duration">
                    <span>Duration</span>
                    <p>{{course_by_id.completion_of_days }}</p>
           </div>
           <div class="course-duration">
                    <span>Hours</span>
                    <p>{{course_by_id.completion_of_hrs }}</p>
           </div>
           <div class="course-duration">
                    <span>Starts</span>
                    <p>{{course_by_id.start}}</p>
           </div>
        </div>
        <div class="course-view-buttons">
                    <button onclick="scrollToElement('trainer')">View Schedules</button>
                    <button>
                        <a href="{% url 'download_brochure' course_by_id.course_id %}" style="text-decoration: none; color: inherit;">
                            <i class='bx bxs-download'></i> Download Brochure
                        </a>
                    </button>
        </div>
        </div>
        </div>
        <div class="course-view-img">
            <div class="video-container">
                <video id="videoPlayer" src="{{course_by_id.course_video.url}}" muted="false">
                    Your browser does not support the video tag.
                </video>
                <button id="playPauseButton" class="play-button">
                    <i class="fas fa-play"></i>
                </button>
            </div>   
            
        </div>
    </div>
    <div class="text-center">Course Certification</div>
    <div class="course_center">
        <div class="course_sample">
            <img src="{{course_by_id.course_sample_certificate.url}}" alt="">
        </div>
    </div>
    <div class="text-center">Course Trainers</div>
        <div class="trainer-card-row" id="trainer">
            {% for trainer in course_by_id.trainers.all %}
            <div class="trainer-card">
                <img src="{{trainer.trainer_photo.url}}" alt="">
                <p>{{ trainer.trainer_name }}</p>
                <button onclick="enrollUser('{{course_by_id.course_id}}')">Enroll</button>
            </div>
        {% endfor %}
        </div>
    </div>
    <div class="text-center">Select The Trainers By Region</div>
    <div class="course-schedules">
       <div class="column">
        <select id="region">
            <option value="">Select the Region</option>
             <script>
                $(document).ready(function(){
                    fetchRegions('{{course.course_id}}');
                })
             </script>
        </select>
    </div>
    <input type="date" id="fdate"> 
    </div>
    <div id="results"></div>
</body>
<script>
    document.getElementById('playPauseButton').addEventListener('click', function () {
    const video = document.getElementById('videoPlayer');
    if (video.paused) {
        video.play();
        this.innerHTML = '<i class="fas fa-pause"></i>';
    } else {
        video.pause();
        this.innerHTML = '<i class="fas fa-play"></i>';
    }
});
const apiKey = 'fe11c7e7c8cf563a60f484f3';
    // Fetch regions and populate the dropdown
    function fetchRegions(courseId) {
        $.ajax({
            url: 'https://restcountries.com/v3.1/all',
            method: 'GET',
            success: function(data) {
                const regionSelect = $("#region" + courseId);
                regionSelect.empty();
                data.forEach(country => {
                    const currency = country.currencies ? Object.keys(country.currencies)[0] : 'N/A';
                    const countryName = country.name.common; // You can also use country.name.official
                    const option = `<option value="${countryName}">${countryName}</option>`;
                    regionSelect.append(option);
                });
            },
            error: function() {
                alert("Failed to fetch regions.");
            }
        });
    }
function scrollToElement(elementId) {
    const element = document.getElementById(elementId);
    if (element) {
        element.scrollIntoView({ behavior: 'smooth' });
    }
}
function filterBy(){
    let fregion = $("#region").val();
    let fdate = $("#fdate").val();

    if (fregion) {  // Only proceed if a region is selected
        $.ajax({
            type: "POST",
            url: "/filter_by/",
            data: {
                "fregion": fregion,
                "fdate": fdate,
                "csrfmiddlewaretoken": "{{ csrf_token }}",  // Include CSRF token if needed
            },
            success: function(data) {
                // Clear previous results
                $("#results").empty();

                // Check if there are any results
                if (data.data && data.data.length > 0) {
                    data.data.forEach(function(schedule) {
                        // Adjust this HTML structure as per your data fields
                        let resultHTML = `
                            <div class="schedule-item">
                                 <h4>Trainer: ${schedule.trainer__trainer_name}</h4>
                                <p>Region: ${schedule.region}</p>
                                <p>Date: ${schedule.start_date} - ${schedule.end_date}</p>
                                <p>Time: ${schedule.schedule_start_time} - ${schedule.schedule_end_time}</p>
                            </div>
                        `;
                        $("#results").append(resultHTML);
                    });
                } else {
                    // Show message if no results found
                    $("#results").html("<p>No schedules found for this selection.</p>");
                }
            },
            error: function(xhr, status, error) {
                console.error("Error:", error);
                $("#results").html("<p>There was an error processing your request. Please try again.</p>");
            }
        });
    }
}

$(document).ready(function() {
    // Bind event listeners to both the region and date inputs
    $("#fregion, #fdate").on("change", function() {
        filterBy();  // Call filter function when either field changes
    });
});
function enrollUser(id){
    window.location.href = '/payment_page/'+encodeURIComponent(id);
}
</script>
{% endblock navbar %}
